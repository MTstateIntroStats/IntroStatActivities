# Handedness of Male Boxers

## Learning objectives

* Identify the two possible explanations (one assuming the null hypothesis, and one assuming the alternative hypothesis) for a relationship seen in sample data

* Given a research question, construct the null and alternative hypotheses
  in words and using appropriate statistical symbols
  
* Describe and perform simulation-based hypothesis tests for a single proportion

* Interpret and evaluate a p-value

* Use bootstrapping to find a confidence interval for a single proportion

## Terminology review

These are a few of the terms we will cover in today's activity.

* Parameter of Interest

* Null Hypothesis

* Alternative Hypothesis

* Null distribuiton

* p-value

* Bootstrapping

* Confidence Interval

To review these concepts see Chapter 5 in your textbook

## Steps of the statistical investigation process

We will work through a six step process to complete a hypothesis test for a single proportion.

* **Ask a research question** that can be addressed by collecting data. What are the researchers trying to show.

* **Design a study and collect data**. This step involves selecting the people or objects to be studied and how to gather relevant data on them.

* **Summarize and Visualize the data**. Calculate summary statistics and create graphical plots that best represent the research question.

* **Use statistical analysis methods to draw inferences from the data**. Choose an analysis technique appropriate for the data and identify the p-value. In this study, we will focus on using randomization.

* **Communicate the results and answer the research question**. Using the p-value and confidence interval from the analysis, determine whether the data provide statistical evidence against the null hypothesis. 

* **Revisit and look forward** to point out limitations of the study and suggest new studies that could be performed to build on the findings of the study 

## Handedness of male boxers

Left-handedness is a trait that is found in about 10% of the population. The fighting claim states that left-handed men have an advantage in competition.  Past studies have shown that left-handed men are over-represented among professional fighters. In this random sample of 500 male boxers we will see if there is an over-prevalence of left-handed fighters.

```{r echo=F, fig.height=4}
handedness <- read.csv("data/Male_boxers.csv")
handedness$Stance <- factor(handedness$Stance)
set.seed(12980)
handedness_sub <- handedness[sample(nrow(handedness), 500), ]
```

### Summary statistics review

1.  What are the observational units?

\vspace{0.5in}

2.  What variable are we testing?  Is it categorical or quantitative?

\vspace{1in}

3. What type of plot would be appropriate to visually display the data?

\vspace{1in}

4. Write out in context the statistic will we calculate to summarize the data.

\vspace{0.5in}

### Ask a research question

5. Identify the research question for this study.

\vspace{1in}

### Design a study and collect data

6. What is the target population for this study?

\vspace{0.5in}

7. Did the researchers use a biased or an unbiased method of selection? Explain your answer.

\vspace{1in}

### Summarize and visualize the data

```{r}
# Counts for Handedness
tally(~Stance, data=handedness_sub, margins=T) 
#Tally creates a table with a count for each level of the variable
```
8.  Calculate the appropriate summary statistic that represents the research question.  Use appropriate notation.

\vspace{0.5in}

### Use statistical analysis methods to draw inferences from the data

When testing data we must first identify the null hypothesis.  The null hypothesis is written about the parameter of interest, the true value of interest.  

9.  Write out the parameter of interest. (Hint: the true proportion of....)

\vspace{1in}

10.  We will assume that the true proportion of male boxers who are left handed is the same as the general population, 0.1. Using the parameter of interest in question 9, write out the null hypothesis in words.

\vspace{1in}

The notation used for a true proportion is $\pi$.  Since this summarizes a population, it is a parameter. When writing the null hypothesis in notation we set the parameter equal to the null value, $H_0: \pi = \pi_0$

11. Write the null hypothesis in notation using the null value of 0.1.

\vspace{0.5in}

The alternative hypothesis is the claim to be tested and the direction is based on the research question.  

12.  Based on the research question from question 5, are we testing that the parameter is greater than 0.1, less than 0.1 or different than 0.1? 

\vspace{0.5in}

13. Write out the alternative hypothesis in words.

\vspace{1in}

14.  Write out the alternative hypothesis in notation.

\vspace{0.5in}

Remember that when utilizing a hypothesis test, we are evaluating two competing possibilities. For this study the **two possibilities** are either...

* The true proportion of male boxers who are left handed is 0.1 and our results just occurred by random chance or
  
* The true proportion of male boxers who are left handed is greater than 0.1 and our results reflect this
  
Notice that these two competing possibilities represent the null and alternative hypotheses.
  
The null distribution is created under the assumption the null hypothesis is true.  In this case, we assume the true proportion of male boxers who are left handed is 0.1 so we will create 1000 different simulations of 500 boxers under this assumption.

Let's think about how to use cards to create one simulation of 500 boxers under the assumption the null hypothesis is true.  Suppose blue cards represents left-handed and red cards represents right-handed.

15.  How many cards total do we need?  How many blue ones?  How many red ones?

\vspace{0.5in}

16.  Next, we would mix the cards together and draw 1 card, write down if it's red or blue, and replace the card.  How many times would we need to repeat this process to simulate our sample?

\vspace{0.5in}

17.  What would we plot on the null distribution?
\vspace{1in}

We will use the computer to simulate 1000 simulated proportions of male boxers who are left handed for a sample size of 500 based on the assumption that the true proportion of male boxers who are left handed is 0.1.  This is called the null distribution because it is created based on the assumption that the null hypothesis is true.

To use the computer simulation, we will need to enter the "probability of success," "sample size," "number of repetitions," "as extreme as," and the "direction" (matches the direction of the alternative hypothesis).

18.  What values should be entered into the simulation?

\vspace{0.25in}
    Probability of success:
    
\vspace{0.25in}
    Sample size:

\vspace{0.25in}
    Number of repetitions:
    
\vspace{0.25in}
    As extreme as:
    
\vspace{0.25in}
    Direction:
    
\vspace{0.25in}

```{r, echo = FALSE}
#Note will need to update to loading catstats when package is ready
###############
#Function to reproduce one proportion test applet
#Arguments: 
#probability_success: value between 0 and 1, represents null hypothesis value for proportion
#sample_size: number of trials used to compute proportion
#number_repetitions: number of draws for simulation test
#as_extreme_as: observed statistic (between 0 and 1)
#direction: one of "greater", "less", or "two-sided" to give direction of hypothsis test
#report_value: value to return from simulations - "number" for number of successes or "proportion" for proportion of successes
#
#Returns: produced plot of distribution of simulated values, with values as or more extreme
#than specified value highlighted and reports proportion of successes in simulations as subtitle on plot
###############

one_proportion_test <- function(probability_success = 0.5,
                                sample_size = 5,
                                number_repetitions = 1,
                                as_extreme_as,
                                direction = c("greater", "less", "two-sided"),
                                report_value = c("number", "proportion")){
  if(number_repetitions < 1 | !(number_repetitions %%1 == 0))
    stop("number of repetitions must be positive and integer valued")
  if(sample_size < 1 | !(sample_size %%1 == 0))
    stop("Sample size must be positive and integer valued")
  if(probability_success < 0 | probability_success > 1)
    stop("Probability of success must be between zero and one")
  if(!(direction %in% c("greater", "less", "two-sided")))
    stop("Direction must be one of 'greater',  'less', or 'two-sided'")
  if(!(report_value %in% c("number", "proportion")))
    stop("Value to report must be either 'number' or 'proportion' of successes")
  if(is.null(as_extreme_as))
    stop("Must enter cutoff value for 'as_extreme_as")
  
  number_heads <- rbinom(number_repetitions, sample_size, probability_success)
  range_heads <- max(number_heads) - min(number_heads)
  success_tab = table(number_heads)
  
  if(!(direction == "two-sided")){
    if(report_value == "number"){
      proportion_extreme <- ifelse(direction == "greater",
                                   mean(number_heads >= as_extreme_as),
                                   mean(number_heads <= as_extreme_as))
    }else {
      proportion_extreme <- ifelse(direction == "greater",
                                   mean(number_heads/sample_size >= as_extreme_as),
                                   mean(number_heads/sample_size <= as_extreme_as))
    }
    
    if(report_value == "number"){
      plot(0,0, "n", xlim = c(min(min(number_heads), as_extreme_as-range_heads/5), 
                              max(max(number_heads), as_extreme_as + range_heads/5)),
           ylim = c(0, max(success_tab)+1),
           xlab = "Number of successes", ylab = "", yaxt ="n",
           sub = paste("Proportion of Samples = ", 
                       proportion_extreme*number_repetitions, 
                       "/", number_repetitions, " = ", 
                       round(proportion_extreme,4), sep = ""))
      for(i in 1:length(success_tab)){
        lines(rep(names(success_tab)[i],2), c(0, success_tab[i]), lwd = 5, 
              col = ifelse(direction == "greater",
                           ifelse(as.numeric(names(success_tab[i])) >= as_extreme_as, "blue", "black"),
                           ifelse(as.numeric(names(success_tab[i])) <= as_extreme_as, "blue", "black")))
      }
      abline(v = ifelse(direction == "greater", as_extreme_as-0.5, as_extreme_as + 0.5), 
             col = "blue", lwd = 2)
      cutoff_label <- ifelse(direction == "greater",
                             paste(">=", as_extreme_as),
                             paste("<=", as_extreme_as))
      text(ifelse(direction == "greater", as_extreme_as-0.25, as_extreme_as+0.25), 
           max(success_tab), labels = cutoff_label,
           pos = ifelse(direction == "greater", 4, 2))
    }else{
      plot(0,0, "n", xlim =c(min(min(number_heads)/sample_size, as_extreme_as-range_heads/(5*sample_size)), 
                             max(max(number_heads)/sample_size, as_extreme_as + range_heads/(5*sample_size))),
           ylim = c(0, max(success_tab)+1),
           xlab = "Proportion of successes", ylab = "", yaxt ="n",
           sub = paste("Proportion of Samples = ", 
                       proportion_extreme*number_repetitions, 
                       "/", number_repetitions, " = ", 
                       round(proportion_extreme,4), sep = ""))
      for(i in 1:length(success_tab)){
        lines(rep(as.numeric(names(success_tab)[i])/sample_size,2), c(0, success_tab[i]), lwd = 5, 
              col = ifelse(direction == "greater",
                           ifelse(as.numeric(names(success_tab[i]))/sample_size >= as_extreme_as, 
                                  "blue", "black"),
                           ifelse(as.numeric(names(success_tab[i]))/sample_size <= as_extreme_as, 
                                  "blue", "black")))
      }
      abline(v = ifelse(direction == "greater", as_extreme_as-0.5/sample_size, 
                        as_extreme_as + 0.5/sample_size), col = "blue", lwd = 2)
      cutoff_label <- ifelse(direction == "greater",
                             paste(">=", as_extreme_as),
                             paste("<=", as_extreme_as))
      text(ifelse(direction == "greater", as_extreme_as-0.25/sample_size, as_extreme_as+0.25/sample_size), 
           max(success_tab), labels = cutoff_label,
           pos = ifelse(direction == "greater", 4, 2))
    }
  }else if(report_value == "number"){
    if(as_extreme_as > probability_success*sample_size){
      upper = as_extreme_as
      lower = max(0, 2*probability_success*sample_size-as_extreme_as)
    }else{
      lower = as_extreme_as
      upper = min(sample_size, 2*probability_success*sample_size-as_extreme_as)
    }
    proportion_extreme <- mean(number_heads <= lower | number_heads >= upper)
    
    plot(0,0, "n", xlim = c(min(min(number_heads), lower-range_heads/5), 
                            max(max(number_heads), upper + range_heads/5)),
         ylim = c(0, max(success_tab)+1),
         xlab = "Number of successes", ylab = "", yaxt ="n",
         sub = paste("Proportion of Samples = ", 
                     proportion_extreme*number_repetitions, 
                     "/", number_repetitions, " = ", 
                     round(proportion_extreme,4), sep = ""))
    for(i in 1:length(success_tab)){
      lines(rep(names(success_tab)[i],2), c(0, success_tab[i]), lwd = 5, 
            col = ifelse(as.numeric(names(success_tab[i])) <= lower |
                           as.numeric(names(success_tab[i])) >= upper, "blue", "black"))
    }
    abline(v = c(lower + 0.5, upper - 0.5), 
           col = "blue", lwd = 2)
    cutoff_label <- c(paste("<=", lower), paste(">=", upper))
    text(c(lower-0.25, upper+0.25), 
         rep(max(success_tab),2), labels = cutoff_label,
         pos = c(4, 2))
  }else{
    if(as_extreme_as > probability_success){
      upper = as_extreme_as
      lower = max(0, 2*probability_success-as_extreme_as)
    }else{
      lower = as_extreme_as
      upper = min(1, 2*probability_success-as_extreme_as)
    }
    proportion_extreme <- mean(number_heads <= lower*sample_size | number_heads >= upper*sample_size)
    
    plot(0,0, "n", xlim =c(min(min(number_heads)/sample_size, lower-range_heads/(5*sample_size)), 
                           max(max(number_heads)/sample_size, upper + range_heads/(5*sample_size))),
         ylim = c(0, max(success_tab)+1),
         xlab = "Proportion of successes", ylab = "", yaxt ="n",
         sub = paste("Proportion of Samples = ", 
                     proportion_extreme*number_repetitions, 
                     "/", number_repetitions, " = ", 
                     round(proportion_extreme,4), sep = ""))
    for(i in 1:length(success_tab)){
      lines(rep(as.numeric(names(success_tab)[i])/sample_size,2), c(0, success_tab[i]), lwd = 5, 
            col = ifelse(as.numeric(names(success_tab[i]))/sample_size <= lower |
                           as.numeric(names(success_tab[i]))/sample_size >= upper, "blue", "black"))
    }
    abline(v = c(lower + 0.5/sample_size, upper - 0.5/sample_size), 
           col = "blue", lwd = 2)
    cutoff_label <- c(paste("<=", lower), paste(">=", upper))
    text(c(lower+0.25/sample_size, upper-0.25/sample_size), 
         rep(max(success_tab),2), labels = cutoff_label,
         pos = c(2, 4))
  }
  
}
```

```{r}
one_proportion_test(probability_success = 0.1, #Null hypothesis value
                    sample_size = 500, #Enter sample size
                    number_repetitions = 1000, #Enter number of simulations
                    as_extreme_as = 81/500, #observed statistic
                    direction = "greater", #specify direction of alternative hypothesis
                    report_value = "proportion") #Reporting proportion or number of successes?
```

19. Around what value is the null distribution centered?  Why does that make sense?

\vspace{1in}

20. Where does the statistic (value from question 8) fall in the null distribution?  Is it towards the center or in one of the tails?  

\vspace{1in}

21.  Is the statistic likely to happen or unlikely to happen if the true proportion of male boxers is 0.1?  Explain your answer.

\vspace{1in}

22.  Using the simulation, what is the proportion of samples at this summary statistic or greater, if the true proportion of male boxers is 0.1? *Hint: Look under the simulation.*

\vspace{1in}

This is the p-value.  The smaller the p-value the more evidence we have against the null hypothesis.

23. Using the following guidelines for the strength of evidence, how much evidence do the data provide against the null hypothesis?

![](images/soe_gradient.png)
\vspace{0.5in}

A point estimate provides a single plausible value for a parameter. However, a point estimate is rarely perfect; usually there is some error in the estimate. In addition to supplying a point estimate of a parameter, a next logical step would be to provide a plausible range of values for the parameter. This plausible range of values for the population parameter is called a confidence interval. 

We will use bootstrapping to find the 95% confidence interval. 

24.  What is bootstrapping?
\vspace{1in}
```{r, echo = FALSE}
#Delete when can load catstats library
###############
#Function to produce bootstrap CI for one proportion
#Arguments: 
#sample_size: number of trials used to compute proportion
#number_success: how many successes were observed in those trials?
#number_repetitions: number of draws for simulation test
#confidence level: confidence level for interval in decimal form.  Defaults to 95%
#
#Returns: produced plot of distribution of bootstrapped values, with values as or more extreme
#than confidence interval range highlighted and reports CI as subtitle on plot
###############

one_proportion_bootstrap_CI <- function(sample_size, number_successes,                        
                                        number_repetitions = 100, confidence_level = 0.95){
  if(number_repetitions < 1 | !(number_repetitions %%1 == 0))
    stop("number of repetitions must be positive and integer valued")
  if(number_successes < 1 | !(number_successes %%1 == 0))
    stop("number of successes must be positive and integer valued")
  if(sample_size < 1 | !(sample_size %%1 == 0))
    stop("sample size must be positive and integer valued")
  if(confidence_level < 0 | confidence_level > 1)
    stop("Confidence level must be given in decimal form")
  
  sim_pop <- rep(0, sample_size)
  sim_pop[1:number_successes] <- 1
  
  sim_props <- rep(NA, number_repetitions)
  for(i in 1:number_repetitions){
    sim_props[i] <- mean(sample(sim_pop, sample_size, replace = TRUE))
  }
  
  success_tab = table(sim_props)
  
  low_ci <- quantile(sim_props, (1-confidence_level)/2)
  high_ci <- quantile(sim_props, 1-(1-confidence_level)/2)
  
  plot(0,0, "n", xlim = c(min(min(sim_props), low_ci-(max(sim_props)-min(sim_props))/5), max(sim_props)),
       ylim = c(0, max(success_tab)+1),
       xlab = "Bootstrapped values of the proportion", ylab = "", yaxt = "n",
       sub = paste0(100*confidence_level, "% CI: (", 
                    low_ci, ", ", high_ci, ")"))
  for(i in 1:length(success_tab)){
    lines(rep(as.numeric(names(success_tab)[i]),2), c(0, success_tab[i]), lwd = 5, 
          col = ifelse(as.numeric(names(success_tab[i])) <= low_ci |
                         as.numeric(names(success_tab[i])) >= high_ci, "blue", "black"))
  }
  abline(v = c(low_ci, high_ci), 
         col = "blue", lwd = 2)
  cutoff_label <- c(paste(round(100*(1-confidence_level)/2, 1), "percentile"), 
                    paste(round(100*(1-(1-confidence_level)/2), 1), "percentile"))
  text(c(low_ci, high_ci), 
       rep(max(success_tab),2), labels = cutoff_label,
       pos = c(2, 4), cex = .75)
}


```

```{r}
one_proportion_bootstrap_CI(sample_size = 500, #Sample size
                    number_successes = 81, #Observed number of successes
                    number_repetitions = 1000, #Number of bootstrap samples to use
                    confidence_level = 0.95) #Confidence level as a decimal
```

25. Explain why the blue lines are at the 2.5th percentile and the 97.5th percentile.

\vspace{1in}

26. Report the 95% bootstrapped confidence interval for $\pi$.  Use interval notation: (lower value, upper value).

\vspace{1in}
27.  What are we 95% confident is contained within this interval?

\vspace{1in}

### Communicate the results and answer the research question

When we write a conclusion we answer the research question by stating how much evidence there is for the alternative hypothesis.

28.  Write a paragraph summarizing the results.  Be sure to include:

* Summary statistic

* P-value

* Conclusion in context

* Confidence Interval

* Interpretation of the Confidence Interval

\vspace{3in}

### Revisit and look forward

29. Suggest a new research question that you might investigate, building on what you learned in this study.

\vspace{1in}



## Additional notes

Use this space to summarize your thoughts and take additional notes on today's activity.

