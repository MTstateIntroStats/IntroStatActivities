---
output:
  pdf_document: default
  html_document: default
---
# Winter Sports Helmet Use and Head Injuries

## Learning objectives

* Write out the null and alternative hypothesis for two categorical variables

* Assess the conditions to use the standard normal distribution for a difference in proportions

* Calculate the Z test statistic for the difference in proportions

* Find the p-value and assess the strength of evidence

* Create and interpret a confidence interval for the difference in proportions

## Terminology review
In today's activity, we will use theory-based methods to analyze two categorical variables. Some terms covered in this activity are:

* Conditional proportion

* Z test

* $z*$ multiplier

* Null hypothesis

* Alternative hypothesis

* Test statistic

* Standard normal distribution

* Independence and success-failure conditions

* Type 1 and Type 2 errors

* Decisions

To review these concepts, see Chapter 5 in your textbook.

\newpage

## Helmet use and head injuries
In "Helmet Use and Risk of Head Injuries in Alpine Skiers and Snowboarders" by Sullheim et. al., in the *Journal of the American Medical Association*, Vol. 295, No. 8 (2006), we can see the summary results from a random sample 3562 skiers and snowboarders involved in accidents in the two-way table below. Is there evidence that safety helmet use reduces the risk of head injury for skiers and snowboarders? 

|                | Helmet Use | No Helmet Use | Total |
|:--------------:|:----------:|:-------------:|:-----:|
| Head Injury    |     96     |      480      |  576  |
| No Head Injury |     656    |      2330     |  2986 |
| Total          |     752    |      2810     |  3562 |

These counts can be found in `R` by using the `count()` function:
```{r, echo=TRUE, warning=FALSE, message=FALSE, collapse=FALSE}
injury <- read.csv("data/head_injury.csv") # Read data set in
injury <- # Write over original data with the following
  injury %>% # Pipe data set into
  mutate(Helmet <- factor(Helmet),
         Injury <- factor(Injury)) # Convert to factors

injury %>% group_by(Helmet) %>% count(Injury)
```


### Vocabulary review {-}

1.  What is the explanatory variable?

\vspace{0.4in}

2. What is the response variable?

\vspace{0.4in}

3. Is this an experiment or observational study?  Justify your answer.

\vspace{0.4in}

4.  Put an X in the box that represents the appropriate scope of inference for this study.

|                    |                  |       Study Type      |                     |
|:------------------:|:----------------:|:---------------------:|---------------------|
|                    |                  | Randomized Experiment | Observational Study |
| Selection of Cases | Random Sample    |                       |                     |
|                    | No Random Sample |                       |                     |


5. What is the conditional proportion of skiers/snowboarders with a head injury that wore a helmet?

\vspace{.6in}

6. What is the conditional proportion of skiers/snowboarders with a head injury that did not wear a helmet?

\vspace{.6in}


### Ask a research question {-}

In this study we are looking at the relationship between two groups or two parameters ($\pi_1$ and $\pi_2$).  Remember we define the parameter for a categorical variable as the true proportion of observational units that are labeled as a "success" in the response variable.  

7. Write the two parameters of interest for this study.  Let 1 = skier/snowboarder wore helmet, 2 = skier/snowboarder did not wear helmet.

   $\pi_1$ - 
\vspace{0.5in}

   $\pi_2$ - 
\vspace{0.5in}

When comparing two groups, we assume the two parameters are equal in the null hypothesis---there is no association between the variables.

8.  Write the null hypothesis out in words using your answers to question 7.

\vspace{1in}

9.  What is the research question?

\vspace{1in}

10. Based on the research question fill in the appropriate sign for the alternative hypothesis ($<$, $>$, or $\neq$):
\vspace{0.25in}

|           $H_A: \pi_1 -\pi_2$ __________ 0


\newpage 
### Summarize and visualize the data {-}

```{r echo=FALSE, fig.height=4}
injury %>%
ggplot(aes(x = Helmet, fill = Injury)) +   #This specifies the variables
  geom_bar(stat = "count", position = "fill") +  #Tell it to make a stacked bar plot
  labs(title = "Segmented Bar Plot of Helmet Use by Injury",  #Make sure to title your plot 
       x = "___________________",   #Label the x axis
       y = "",  #Remove y axis label
       fill = "_____________") + #Change legend label
  scale_fill_discrete(labels = c("_________", "_________"), type=c("black","grey")) +
  scale_x_discrete(labels = c("_____________", "_____________")) +
  theme_bw()
```

11.  Fill in the blanks on the graph with the appropriate variables and values to complete the segmented bar plot showing the proportion of head injuries between those who use helmets and those who do not use helmets.  *Hint*: Use the conditional proportions from questions 5 and 6.

\vspace{0.1in}

12.  Based on the segmented bar plot, Does there appear to be an association between helmet use and head injury?  Explain.

\vspace{1in}

13.  Calculate the point estimate for this study.  Use helmet use minus no helmet use as the order of subtraction.

\vspace{1in}


14. What is the notation used for the value calculated in question 14?


\vspace{0.5in}
\newpage
### Use statistical analysis methods to draw inferences from the data {-}

To test the null hypothesis we could use simulation methods as we did with a single categorical variable. In this activity we will focus on theory-based methods.  Like with a single proportion, the difference in proportions can be mathematically modeled using the normal distribution if certain conditions are met.

Conditions for the sample distribution of $\hat{p}_1-\hat{p}_2$:

* Independence: The data are independent within and between the two groups.

* Success-Failure Condition: The success-failure condition holds for each group.

\vspace{.25in}

15.  Is the independence condition met? Explain your answer.

\vspace{1in}

16. Is the success-failure condition met for each group?  Explain your answer.

\vspace{1in}

To calculate the test statistic we use: 

$$
Z = \frac{\text{point estimate} - \text{null value}}{SE}
$$

where the standard error is calculated using the pooled proportion of successes.

$$
SE(\hat{p}_1-\hat{p}_2)=\sqrt{\hat{p}_{pool}(1-\hat{p}_{pool})(\frac{1}{n_1}+\frac{1}{n_2})}, \text{  where}
$$
$$
\hat{p}_{pool} = \frac{\text{number of "successes"}}{\text{number of cases}} = \frac{\hat{p}_1 n_1+\hat{p}_2 n_2}{n_1+n_2}
$$

\vspace{.25in}

17. Calculate the $SE(\hat{p}_1-\hat{p}_2)$.

\vspace{1in}

18. Calculate the test statistic.

\vspace{1in}

We will use the pnorm function in `R` to find the p-value. Use the provided R markdown file and enter the value of the test statistic at xx.

```{r, echo=TRUE, eval=FALSE}
pnorm(xx, # Enter value of test statistic
      m=0, s=1 # Using the standard normal mean = 0, sd = 1
      lower.tail=TRUE) # Gives a p-value less than the test statistic
```
    

19.  Report the p-value.
\vspace{0.2in}

20.  How much evidence does the p-value provide against the null hypothesis?

\vspace{0.4in}

To find a confidence interval for the difference in proportions we will add and subtract the margin of error from the point estimate to find the two endpoints.

 $$\hat{p}_1-\hat{p}_2\pm z^*SE(\hat{p}_1-\hat{p}_2), \text{where}$$
 
 $$SE(\hat{p}_1-\hat{p}_2) = \sqrt{\left(\frac{\hat{p}_1 (1-\hat{p}_1)}{n_1}+\frac{\hat{p}_2 (1-\hat{p}_2)}{n_2}\right)}$$
 
Note that the formula changes when calculating the variability around the statistic in order to calculate a confidence interval!  Here, use the sample proportions for each group to calculate the standard error for the difference in proportions.


21. Calculate the standard error for a difference in proportions to create a 95% confidence interval.  

\vspace{1in}

The $z^*$ multiplier is found under the standard normal distribution. We find the values that encompass the middle 95% of the distribution.  If 95\% of the standard normal distribution should be in the middle, that leaves 5\% in the tails, or 2.5\% in each tail.  The qnorm function in `R` will tell us the $z^*$ value for the desired percentile (in this case, 95\% + 2.5\% = 97.5\% percentile). 

```{r, echo=TRUE, collapse=FALSE}
qnorm(0.975) # Multiplier for 95% confidence interval
```

22. Using the multiplier of $z^*$ = 1.96, calculate the 95% confidence interval for the difference in true proportion of head injuries for those that used helmets minus those who did not. 

\vspace{1in}

23. Interpret the confidence interval found in question 23 in context of the problem.

\vspace{1in}

24. Write a paragraph summarizing the results of the study.  Be sure to describe:

* Summary statistic

* Test statistic and interpretation

* P-value and interpretation

* Conclusion (written to answer the research question)

* Confidence interval and interpretation

* Scope of inference

\vspace{2in}


### Types of errors {-}

Hypothesis tests are not flawless. In a hypothesis test, there are two competing hypotheses: the null and alternative. We make a decision about which might be true, but we may choose incorrectly.  

<!-- |       |            | Test Conclusion |                     | -->
<!-- |       |            | Reject $H_0$    | Fail to reject $H_0$| -->
<!-- |:-----:|:----------:|-----------------|---------------------| -->
<!-- | Truth | $H_0$ true |  good decision  |  Type 1 Error       | -->
<!-- |       | $H_A$ true |  Type 2 Error   |  good decision      | -->

\begin{table}
\caption{Four different possible scenarios for hypothesis tests.}
\centering
\begin{tabular}[h]{ll|cc}
\hline
 & &  \multicolumn{2}{c}{\textbf{Test conclusion}} \\
 &  & \multicolumn{1}{c}{Fail to reject $H_0$} & \multicolumn{1}{c}{Reject $H_0$}\\
\hline
 & $H_0$ true & Good decision & Type 1 Error\\
\hline
\textbf{Truth} & $H_A$ true & Type 2 Error & Good decision\\
\hline
\end{tabular}
\end{table}

Shown in the table above, a **Type 1 Error** is rejecting the null hypothesis when $H_0$ is actually true. A **Type 2 Error** is failing to reject the null hypothesis when the alternative is actually true.

25.  Using a significance level of 0.05, what decision do you make in regards to the null hypothesis?

\vspace{0.5in}

267. What type of error could we have made?

\vspace{0.5in}

27.  Write this error in context of the problem.

\vspace{1in}

\newpage

## Additional notes

Use this space to summarize your thoughts and take additional notes on today's activity.
