## Week 9 - Activity 13:  Good Samaritan --- Testing

\setstretch{1}

### Learning objectives

* Given a research question involving two categorical variables, construct the null and alternative hypotheses
  in words and using appropriate statistical symbols.
  
* Describe and perform a simulation-based hypothesis test for a difference in proportions.

* Interpret and evaluate a p-value for a simulation-based hypothesis test for a difference in proportions.

### Terminology review
In this week's in-class activity, we will use theory-based methods to analyze two categorical variables. Some terms covered in this activity are:

* Conditional proportion

* Null hypothesis

* Alternative hypothesis

* Type 1 and Type 2 errors

* Decision of a hypothesis test

To review these concepts, see Chapter 5 in your textbook.


### Helmet use and head injuries
In "Helmet Use and Risk of Head Injuries in Alpine Skiers and Snowboarders" by Sullheim et. al., in the *Journal of the American Medical Association*, Vol. 295, No. 8 (2006), we can see the summary results from a random sample of 3562 skiers and snowboarders involved in accidents in the two-way table below. Is there evidence that safety helmet use is associated with a reduced risk of head injury for skiers and snowboarders? 

|                | Helmet Use | No Helmet Use | Total |
|:--------------:|:----------:|:-------------:|:-----:|
| Head Injury    |     96     |      480      |  576  |
| No Head Injury |     656    |      2330     |  2986 |
| Total          |     752    |      2810     |  3562 |

\newpage

These counts can be found in `R` by using the `count()` function:
```{r, echo=TRUE, warning=FALSE, message=FALSE, collapse=FALSE}
# Read data set in
injury <- read.csv("https://math.montana.edu/courses/s216/data/HeadInjuries.csv") 
injury <- # Write over original data with the following
  injury %>% # Pipe data set into
  mutate(Helmet <- factor(Helmet),
         Outcome <- factor(Outcome)) # Convert to factors

injury %>% group_by(Helmet) %>% count(Outcome)
```

#### Vocabulary review. Complete Q1--Q4 before class. {-}

1.  What is the name of the explanatory variable in the `R` output? What are its categories?

\vspace{0.2in}

2. What is the response variable in the `R` output? What are its categories?

\vspace{0.2in}

\setstretch{1.5}
3. Fill in the blanks with one answer from each set of parentheses: This is an  
________________ (experiment/observational study) because  
______________ (helmet use/head injury) _______ (was/was not)  
randomly ____________ (assigned/selected).

\vspace{0.1in}

4.  Put an X in the box that represents the appropriate scope of inference for this study.

|                    |                  |       Study Type      |                     |
|:------------------:|:----------------:|:---------------------:|---------------------|
|                    |                  | Randomized Experiment | Observational Study |
| Selection of Cases | Random Sample    |                       |                     |
|                    | No Random Sample |                       |                     |
\setstretch{1}


#### Ask a research question {-}

The research question as stated above is: Is there evidence that safety helmet use is associated with a reduced risk of head injury for skiers and snowboarders? In order to set up our hypotheses, we need to express this research question in terms of parameters. 
Remember, we define the parameter for a single categorical variable as the true proportion of observational units that are labeled as a "success" in the response variable.  

\newpage

5. Write the two parameters of interest for this study.  Let 1 = skier/snowboarder wore helmet, 2 = skier/snowboarder did not wear helmet. 
\vspace{1mm}

   $\pi_1$ --- 
\vspace{0.5in}

   $\pi_2$ ---
\vspace{0.5in}

When comparing two groups, we assume the two parameters are equal in the null hypothesis---there is no association between the variables.

6.  Write the null hypothesis out in words using your answers to question 5.

\vspace{0.8in}


7. Based on the research question, fill in the appropriate sign for the alternative hypothesis ($<$, $>$, or $\neq$):
\vspace{0.1in}

|           $H_A: \pi_1 -\pi_2$ __________ 0


 
#### Summarize and visualize the data {-}

8. Using the two-way table given in the introduction, calculate the conditional proportion of helmet-wearing skiers/snowboarders that sustained a head injury.

\vspace{.3in}

9. Using the two-way table given in the introduction, calculate the conditional proportion of non-helmet-wearing skiers/snowboarders that sustained a head injury.

\vspace{.3in}

```{r echo=FALSE, fig.height=4}
injury %>%
ggplot(aes(x = Helmet, fill = Outcome)) +   # This specifies the variables
  geom_bar(stat = "count", position = "fill") +  # Tell it to make a stacked bar plot
  labs(title = "Segmented Bar Plot of Helmet Use by Injury",  # Make sure to title your plot 
       x = "___________________",   # Label the x axis
       y = "",  # Remove y axis label
       fill = "_____________") + # Change legend label
  scale_fill_discrete(labels = c("_________", "_________"), type=c("black","grey")) +
  scale_x_discrete(labels = c("_____________", "_____________")) +
  theme_bw()
```

10.  Fill in the blanks on the segmented bar plot on the previous page with the appropriate variable names and categories to complete the segmented bar plot comparing the proportion of head injuries between those who wear helmets and those who do not wear helmets.  *Hint*: Use the conditional proportions from questions 8 and 9.

\vspace{1mm}

11.  Based on the segmented bar plot, Does there appear to be an association between helmet use and head injury?  Explain using the plot.

\vspace{0.7in}

12.  Calculate the summary statistic for this study.  Use helmet use (`Yes`) minus no helmet use (`No`) as the order of subtraction.

\vspace{0.4in}


13. What is the notation used for the value calculated in question 12?

\vspace{0.1in}

We will now simulate a **null distribution** of sample differences in proportions. The null distribution is created under the assumption the null hypothesis is true.  

14.  First, let's think about how one simulation would be created on the null distribution using cards.  

    How many cards would you need?
\vspace{0.1in}

    What would be written on each card?

\vspace{0.5in}

15. Next, we would mix the cards together and shuffle into two piles.  How many cards would be in each pile?  What would each pile represent?

\vspace{0.8in}

16. Once we have one simulated sample, what would we calculate and plot on the null distribution?  *Hint*: What statistic are we calculating from the data?

\vspace{0.8in}

To create the null distribution of differences in sample proportions, we will use the `two_proportion_test()` function in `R` (in the `catstats` package).  We will need to enter the response variable name and the explanatory variable name for the formula, the data set name (identified above as `injury`), the outcome for the explanatory variable that is first in subtraction, number of repetitions, the outcome for the response variable that is a success (what the numerator counts when calculating a sample proportion), and the direction of the alternative hypothesis.

The response variable name is `Outcome` and the explanatory variable name is `Helmet`.

17.  What inputs should be entered for each of the following to create the simulation?

\vspace{.2in}
* First in subtraction (What is the outcome for the explanatory variable that is used as first in the order of subtraction? `"Yes"` or `"No"`):

\vspace{.2in}
* Number of repetitions:
    
\vspace{.2in}
* Response value numerator (What is the outcome for the response variable that is considered a success? `"Head Injury"` or `"No Head Injury"`):

\vspace{.2in}
* As extreme as (enter the value for the sample difference in proportions):
    
\vspace{.2in}
* Direction (`"greater"`, `"less"`, or `"two-sided"`):

\vspace{.2in}

Using the `R` script file for this activity, enter your answers for question 17 in place of the `xx`'s to produce the null distribution with 1000 simulations; highlight and run lines 1--12 and then 33--39.

```{r, echo=TRUE, eval=FALSE}
two_proportion_test(formula = Outcome ~ Helmet, # response ~ explanatory
    data= injury, # Name of data set
    first_in_subtraction = "xx", # Order of subtraction: enter the name of Group 1
    number_repetitions = 1000, # Always use a minimum of 1000 repetitions
    response_value_numerator = "xx", # Define which outcome is a success 
    as_extreme_as = xx, # Calculated observed statistic (difference in sample proportions)
    direction="xx") # Alternative hypothesis direction ("greater","less","two-sided")
```

18.  Sketch the null distribution created here.

\vspace{1.5in}


19. What value is the null distribution centered around?  Explain why this makes sense.

\vspace{.8in}

20.  What is the p-value? *Remember*: This is the value given at the bottom of the null distribution.

\vspace{0.2in}


21.  Interpret the p-value in context of the study.

\vspace{1in}

22.  How much evidence does the p-value provide against the null hypothesis? *Hint*: Refer to the guidelines given in Activity 6.

\vspace{0.4in}

23.  Write a conclusion to the test. 

\vspace{1in}

24. Write a paragraph summarizing the results of the study as if writing a press release.  Be sure to describe:

* Summary statistic

* Test statistic and interpretation

* P-value and interpretation

* Conclusion (written to answer the research question)

* Scope of inference

\vspace{2in}


### Take-home messages

1.	When comparing two groups, we are looking at the difference between two parameters.  In the null hypothesis, we assume the two parameters are equal, or that there is no difference between the two proportions.  

2.  We use the same guidelines for the strength of evidence as we did in Activity __.  

3.  The standardized statistic when the response variable is categorical is a Z-score and is compared to the standard normal distribution to find the p-value.  To find the standardized statistic, we take the value of the statistic minus the null value, divided by the null standard error of the statistic.  The standardized statistic measures the number of standard errors the statistic is from the null value. 

4.  If we make the decision to reject the null hypothesis (the p-value is less than the significance level), we could have a possible Type 1 error. A Type 1 error occurs when we reject a true null hypothesis (false positive).

5.  If we make the decision to fail to reject the null hypothesis (the p-value is greater than the significance level), we could have a possible Type 2 error. A Type 2 error occurs when we fail to reject a false null hypothesis (false negative).

6. To create one simulated sample on the null distribution for a difference in sample proportions, label $n_1 + n_2$ cards with the response variable outcomes from the original data. Mix cards together and shuffle into two new groups of sizes $n_1$ and $n_2$, representing the explanatory variable groups. Calculate and plot the difference in proportion of successes.


### Additional notes

Use this space to summarize your thoughts and take additional notes on this week's activity and material covered.
