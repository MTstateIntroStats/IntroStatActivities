# Exploratory Data Analysis: Multivariate Thinking

## Learning Outcomes
 
* Build and interpret data visualizations for multiple variables.
* Investigate how the relationship between two variables may change with the value of another variable.

```{r}
SAT <- read.csv("data/sat.csv")
```
The following is a criticism of spending on public education in the United States from a respected political essayist:

The 10 states with the lowest per pupil spending included four -- North Dakota, South Dakota, Tennessee, Utah -- among the 10 states with the top SAT scores. Only one of the 10 states with the highest per pupil expenditures -- Wisconsin -- was among the 10 states with the highest SAT scores. New Jersey has the highest per pupil expenditures, an astonishing $10,561, which teachers' unions elsewhere try to use as a negotiating benchmark. New Jersey's rank regarding SAT scores? Thirty-ninth... The fact that the quality of schools... [fails to correlate] with education appropriations will have no effect on the teacher unions' insistence that money is the crucial variable.
-- George F. Will, (September 12, 1993), "Meaningless Money Factor," The Washington Post, C7. 

The variables are defined as follows:
 * State — Name of state
 
 * expend — Expenditure per pupil in average daily attendance in public elementary and secondary schools, 1994-95 (in thousands of dollars) 
 
* ratio — Average pupil/teacher ratio in public elementary and secondary schools, Fall 1994

* salary — Estimated average annual salary of teachers in public elementary and secondary schools, 1994-95 (in thousands of dollars)

* frac —Percentage of all eligible students taking the SAT, 1994-95

* frac_40 - whether the percentage of all eligible students taking the SAT is less than 40%, 1994-95

* verbal —Average verbal SAT score, 1994-95

* math — Average math SAT score, 1994-95

* sat — Average total score on the SAT, 1994-95

```{r}
plot(SAT)  # Beware - this generates a lot of plots! - plots all pairs of variables
cor(SAT[,-1])  # Print correlations between all quantitative variables.
```

1. What variables are most correlated with SAT score? Explanatory variables highly correlated with the response variable have the potential to be good predictors of the response.

\vspace{1in}

Look at the fitted linear model George Will used. He treated "sat" as the response and "expend" as the explanatory variable:

```{r}
lm1 <- lm(sat~expend, data = SAT)
summary(lm1)
```

```{r echo=t, fig.height=5,fig.width=12}
par(mfrow=c(1,2))
levels(SAT$frac_40) <- c("yes", "no")
scatterplot(sat~expend, lwd=3, data=SAT,pch=20,main="Expenditure vs. SAT Score", smooth=F)
```

```{r echo=t, fig.height=5,fig.width=12}
par(mfrow=c(1,2))
levels(SAT$frac_40) <- c("yes", "no")
scatterplot(sat~expend+frac_40, lwd=3, data=SAT,pch=20,main="Expenditure vs. SAT Score", smooth=F)
```

```{r}
lm2 <- lm(sat~salary, data=SAT)
summary(lm2)
```


```{r}
lm3 <- lm(sat~ratio, data=SAT)
summary(lm3)
```

```{r echo=t, fig.height=5,fig.width=12}
par(mfrow=c(1,2))
scatterplot(sat~salary+frac_40, data=SAT,pch=20,main="Salary vs. SAT Score", smooth=F)
```

```{r echo=t, fig.height=5,fig.width=12}
par(mfrow=c(1,2))
scatterplot(sat~ratio, data=SAT,pch=20,main="Ratio vs. SAT Score", smooth=F)
```

```{r}
lm4 <- lm(sat~frac, data=SAT)
summary(lm4)
```

```{r echo=t, fig.height=5,fig.width=12}
par(mfrow=c(1,2))
scatterplot(sat~frac, data=SAT,pch=20,main="Frac vs. SAT Score", smooth=F)

```

```{r}
plot(sat~expend, data=SAT, type="n",xlab="Expenditure per Pupil (in thousands of dollars)",ylab="Average SAT Score",main="SAT vs. Expenditure by Percent, Taking SAT")
points(SAT$expend[SAT$frac40=="Yes"],SAT$sat[SAT$frac40=="Yes"],pch=15,col="darkgreen",)
points(SAT$expend[SAT$frac40=="No"],SAT$sat[SAT$frac40=="No"],pch=17,col="orange3")
abline(lm(sat[SAT$frac40=="Yes"]~expend[SAT$frac40=="Yes"], data=SAT),col="darkgreen")
abline(lm(sat[SAT$frac40=="No"]~expend[SAT$frac40=="No"], data=SAT),col="orange3")
legend(locator(1),c("Percent < 40%","Percent > 40%"),pch=c(15,17),col=c("darkgreen","orange3"))


cor(SAT$sat[SAT$frac40=="Yes"],SAT$expend[SAT$frac40=="Yes"])
cor(SAT$sat[SAT$frac40=="No"],SAT$expend[SAT$frac40=="No"])
lm(SAT$sat[SAT$frac40=="Yes"]~SAT$expend[SAT$frac40=="Yes"])
lm(SAT$sat[SAT$frac40=="No"]~SAT$expend[SAT$frac40=="No"])
```

```{r}
SAT <- read.csv("http://www.math.montana.edu/courses/s216/data/sats95.csv")
attach(SAT)

plot(sat~expend,xlab="Expenditure per Pupil (in thousands of dollars)",ylab="Average SAT Score",main="Average SAT vs. Expenditure",ylim=c(800,1150))
abline(lm(sat~expend))
# States mentioned by George Will: ND = 34, SD = 41, TN = 42, UT = 44, WI = 49, NJ = 30
text((expend[c(34, 41, 42, 44, 49, 30)]),(sat[c(34, 41, 42, 44, 49, 30)]+10),state.abrev[c(34, 41, 42, 44, 49, 30)])
points(expend[c(34, 41, 42, 44, 49, 30)],sat[c(34, 41, 42, 44, 49, 30)],pch=16)

cor(sat,expend)
lm(sat~expend)

plot(sat~expend,type="n",xlab="Expenditure per Pupil (in thousands of dollars)",ylab="Average SAT Score",main="SAT vs. Expenditure by Percent, Taking SAT")
points(expend[frac40=="Yes"],sat[frac40=="Yes"],pch=15,col="darkgreen")
points(expend[frac40=="No"],sat[frac40=="No"],pch=17,col="orange3")
abline(lm(sat[frac40=="Yes"]~expend[frac40=="Yes"]),col="darkgreen")
abline(lm(sat[frac40=="No"]~expend[frac40=="No"]),col="orange3")
legend(locator(1),c("Percent < 40%","Percent > 40%"),pch=c(15,17),col=c("darkgreen","orange3"))

cor(sat[frac40=="Yes"],expend[frac40=="Yes"])
cor(sat[frac40=="No"],expend[frac40=="No"])
lm(sat[frac40=="Yes"]~expend[frac40=="Yes"])
lm(sat[frac40=="No"]~expend[frac40=="No"])
```

